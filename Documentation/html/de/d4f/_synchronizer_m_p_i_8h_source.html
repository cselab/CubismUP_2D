<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>CubismUP_2D: Cubism/SynchronizerMPI.h Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CubismUP_2D
   </div>
   <div id="projectbrief">Velocity-Pressure solver</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('de/d4f/_synchronizer_m_p_i_8h_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SynchronizerMPI.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../de/d4f/_synchronizer_m_p_i_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *  SynchronizerMPI.h</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Cubism</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *  Created by Diego Rossinelli on 10/17/11.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *  Copyright 2011 ETH Zurich. All rights reserved.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#pragma once</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//#include &lt;xmmintrin.h&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/dd2/_p_u_pkernels_m_p_i_8h.html">PUPkernelsMPI.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d33/_dependency_cube_m_p_i_8h.html">DependencyCubeMPI.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d1d/_grid_m_p_i_8h.html">GridMPI.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d4e/_stencil_info_8h.html">StencilInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="../../d0/ddf/class_synchronizer_m_p_i.html">   25</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html">SynchronizerMPI</a></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keyword">struct </span>I3</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <span class="keywordtype">int</span> ix, iy, iz;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        I3(<span class="keywordtype">int</span> ix, <span class="keywordtype">int</span> iy, <span class="keywordtype">int</span> iz):ix(ix), iy(iy), iz(iz){}</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        I3(<span class="keyword">const</span> I3&amp; c): ix(c.ix), iy(c.iy), iz(c.iz){}</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="keywordtype">bool</span> operator&lt;(<span class="keyword">const</span> I3&amp; a)<span class="keyword"> const</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">        </span>{</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;            <span class="keywordflow">return</span> ix&lt;a.ix || ix==a.ix &amp;&amp; iy&lt;a.iy || ix==a.ix &amp;&amp; iy==a.iy &amp;&amp; iz&lt;a.iz;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    };</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keyword">struct </span>PackInfo { <a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> * block, * <a class="code" href="../../d7/dd2/_p_u_pkernels_m_p_i_8h.html#a7a485735d2946aa4b92203577ff84081">pack</a>; <span class="keywordtype">int</span> sx, sy, sz, ex, ey, ez; };</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keyword">struct </span>SubpackInfo { <a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> * block, * <a class="code" href="../../d7/dd2/_p_u_pkernels_m_p_i_8h.html#a7a485735d2946aa4b92203577ff84081">pack</a>; <span class="keywordtype">int</span> sx, sy, sz, ex, ey, ez; <span class="keywordtype">int</span> x0, y0, z0, xpacklenght, ypacklenght; };</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="../../d3/d21/class_dependency_cube_m_p_i.html">DependencyCubeMPI&lt;MPI::Request&gt;</a> cube;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> isroot;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> synchID;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordtype">int</span> send_thickness[3][2], recv_thickness[3][2];</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordtype">int</span> blockinfo_counter;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="../../da/d04/struct_stencil_info.html">StencilInfo</a> stencil;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    vector&lt;PackInfo&gt; send_packinfos;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    map&lt;Real *, vector&lt;PackInfo&gt; &gt; recv_packinfos;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    map&lt;Real *, vector&lt;SubpackInfo&gt; &gt; recv_subpackinfos;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    vector&lt;Real *&gt; all_mallocs;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    vector&lt;BlockInfo&gt; globalinfos;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    map&lt;Region, vector&lt;BlockInfo&gt; &gt; region2infos;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">//?static?</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    MPI::Cartcomm cartcomm;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">int</span> blocksize[3];</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordtype">int</span> mypeindex[3], pesize[3], mybpd[3];</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordtype">bool</span> periodic[3];</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordtype">int</span> neighborsrank[3][3][3]; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    map&lt;I3,int&gt; c2i;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keyword">struct </span>CommData { </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> * faces[3][2], * edges[3][2][2], * corners[2][2][2]; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        set&lt;MPI::Request&gt; pending;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    } send, recv;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">bool</span> _face_needed(<span class="keyword">const</span> <span class="keywordtype">int</span> d)<span class="keyword"> const</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordflow">return</span> periodic[d] || mypeindex[d] &gt; 0 &amp;&amp; mypeindex[d] &lt; pesize[d]-1;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordtype">bool</span> _myself(<span class="keyword">const</span> <span class="keywordtype">int</span> indx[3])</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">return</span> (indx[0]+pesize[0]) % pesize[0] == mypeindex[0] &amp;&amp;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        (indx[1]+pesize[1]) % pesize[1] == mypeindex[1] &amp;&amp;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        (indx[2]+pesize[2]) % pesize[2] == mypeindex[2];</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordtype">int</span> _rank(<span class="keyword">const</span> <span class="keywordtype">int</span> indx[3])</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    {       </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordtype">int</span> indx_final[3]={indx[0],indx[1],indx[2]};</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;3; ++i)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <span class="keywordflow">if</span> (pesize[i]==1) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> d=indx[i]- mypeindex[i];</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            indx_final[i]=d-pesize[i]*(int)((<span class="keywordtype">double</span>)d/(pesize[i]-1))+mypeindex[i];</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;3;++i)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            assert(indx_final[i]&gt;=-1+mypeindex[i] &amp;&amp; indx_final[i]&lt;2+mypeindex[i]);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordflow">return</span> neighborsrank[indx_final[2]+1-mypeindex[2]][indx_final[1]+1-mypeindex[1]][indx_final[0]+1-mypeindex[0]];</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keyword">template</span> &lt;<span class="keywordtype">bool</span> computesubregions&gt;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    map&lt;Real *, vector&lt;SubpackInfo&gt; &gt; _setup(CommData&amp; data, <span class="keyword">const</span> <span class="keywordtype">int</span> thickness[3][2], <span class="keyword">const</span> <span class="keywordtype">int</span> blockstart[3], <span class="keyword">const</span> <span class="keywordtype">int</span> blockend[3], <span class="keyword">const</span> <span class="keywordtype">int</span> origin[3], vector&lt;PackInfo&gt;&amp; packinfos)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    {       </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        map&lt;Real *, vector&lt;SubpackInfo&gt; &gt; retval;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> NC = stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a6a07ebcb676dabaadf000e1348b8c016">selcomponents</a>.size();</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> bpd[3] = { </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            mybpd[0],</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            mybpd[1],</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            mybpd[2]</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        };</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="comment">//faces</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0; d&lt;3; ++d)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        {           </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other1 = (d+1)%3;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other2 = (d+2)%3;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0; s&lt;2; ++s)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> NFACEBLOCK = NC * thickness[d][s] * blocksize[dim_other1] * blocksize[dim_other2];</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> NFACE = NFACEBLOCK * mybpd[dim_other1] * mybpd[dim_other2];</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">bool</span> needed = _face_needed(d) || NFACE == 0;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                data.faces[d][s] = needed ? _myalloc(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a>)*NFACE, 16) : NULL;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                <span class="keywordflow">if</span> (!needed) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                <span class="keywordtype">int</span> neighbor_index[3];</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                neighbor_index[d] = (mypeindex[d] + 2*s-1 + pesize[d])%pesize[d];</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                neighbor_index[dim_other1] = mypeindex[dim_other1];</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                neighbor_index[dim_other2] = mypeindex[dim_other2];</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                <span class="keywordflow">if</span> (_myself(neighbor_index)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                <span class="keywordtype">int</span> start[3];</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                start[d] = (1-s)*blockstart[d] + s*(blockend[d]-thickness[d][s]);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                start[dim_other1] = 0;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                start[dim_other2] = 0;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                <span class="keywordtype">int</span> end[3];</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                end[d] = (1-s)*(blockstart[d] + thickness[d][s]) + s*blockend[d];</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                end[dim_other1] = blocksize[dim_other1];</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                end[dim_other2] = blocksize[dim_other2];</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> n1 = bpd[dim_other1];</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> n2 = bpd[dim_other2];</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=0; b&lt;n2; ++b) </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> a=0; a&lt;n1; ++a)     </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                    {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                        <span class="keywordtype">int</span> index[3];</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                        index[d] = s*(bpd[d]-1);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                        index[dim_other1] = a;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                        index[dim_other2] = b;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                        </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                        assert(c2i.find(I3(origin[0] + index[0], origin[1] + index[1], origin[2] + index[2]))!=c2i.end());</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">int</span> blockid = c2i[I3(origin[0] + index[0], origin[1] + index[1], origin[2] + index[2])];</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                        </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                        PackInfo info = {(<a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> *)globalinfos[blockid].ptrBlock, data.faces[d][s] + NFACEBLOCK*(a + n1*b), start[0], start[1], start[2], end[0], end[1], end[2]};</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                        </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">bool</span> nonempty = end[0]&gt;start[0] &amp;&amp; end[1]&gt;start[1] &amp;&amp; end[2]&gt;start[2];</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                        <span class="keywordflow">if</span> (nonempty) packinfos.push_back(info);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">if</span> (!stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#ab3fce74853afec119eee90a6274d1559">tensorial</a>) <span class="keywordflow">return</span> retval;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="comment">//edges</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0; d&lt;3; ++d)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other1 = (d+1)%3;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other2 = (d+2)%3;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=0; b&lt;2; ++b)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> a=0; a&lt;2; ++a)</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> NEDGEBLOCK = NC * blocksize[d] * thickness[dim_other2][b] * thickness[dim_other1][a];</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> NEDGE = NEDGEBLOCK * mybpd[d];</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                    </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">bool</span> needed = NEDGE &gt; 0;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                    data.edges[d][b][a] = needed ? _myalloc(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a>)*NEDGE, 16) : NULL;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                    </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                    <span class="keywordflow">if</span> (!needed) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                    </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                    <span class="keywordtype">int</span> neighbor_index[3];</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                    neighbor_index[d] = mypeindex[d];</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                    neighbor_index[dim_other1] = (mypeindex[dim_other1] + 2*a-1 + pesize[dim_other1])%pesize[dim_other1];</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                    neighbor_index[dim_other2] = (mypeindex[dim_other2] + 2*b-1 + pesize[dim_other2])%pesize[dim_other2];</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                    </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                    <span class="keywordflow">if</span> (_myself(neighbor_index)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                    </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                    <span class="keywordtype">int</span> start[3];</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                    start[d] = 0;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                    start[dim_other1] = blockstart[dim_other1]*(1-a) + a*(blockend[dim_other1]-thickness[dim_other1][1]);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                    start[dim_other2] = blockstart[dim_other2]*(1-b) + b*(blockend[dim_other2]-thickness[dim_other2][1]);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                    </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                    <span class="keywordtype">int</span> end[3];</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                    end[d] = blocksize[d];</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                    end[dim_other1] = a*blockend[dim_other1] + (1-a)*(blockstart[dim_other1] + thickness[dim_other1][0]);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                    end[dim_other2] = b*blockend[dim_other2] + (1-b)*(blockstart[dim_other2] + thickness[dim_other2][0]);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                    </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> n = bpd[d];</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0; c&lt;n; ++c)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                    {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                        <span class="keywordtype">int</span> index[3];</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                        index[d] = c;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                        index[dim_other1] = a*(bpd[dim_other1]-1);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                        index[dim_other2] = b*(bpd[dim_other2]-1);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                        </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                        assert(c2i.find(I3(origin[0] + index[0], origin[1] + index[1], origin[2] + index[2]))!=c2i.end());</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">int</span> blockid = c2i[I3(origin[0] + index[0], origin[1] + index[1], origin[2] + index[2])];</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                        </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                        PackInfo info = {(<a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> *)globalinfos[blockid].ptrBlock, data.edges[d][b][a] + NEDGEBLOCK*c, start[0], start[1], start[2],  end[0], end[1], end[2]};</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                        </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">bool</span> nonempty = end[0]&gt;start[0] &amp;&amp; end[1]&gt;start[1] &amp;&amp; end[2]&gt;start[2];</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                        <span class="keywordflow">if</span> (nonempty) packinfos.push_back(info);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                    }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="comment">//new part</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">if</span> (computesubregions)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        {           </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> dface=0; dface&lt;3; ++dface)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            {           </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other1face = (dface+1)%3;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other2face = (dface+2)%3;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0; s&lt;2; ++s)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                    {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                        <span class="keywordtype">int</span> neighbor_pe[3];</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                        neighbor_pe[dface] = (mypeindex[dface] + 2*s-1 + pesize[dface])%pesize[dface];</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                        neighbor_pe[dim_other1face] = mypeindex[dim_other1face];</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                        neighbor_pe[dim_other2face] = mypeindex[dim_other2face];</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                        </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                        <span class="keywordflow">if</span> (_myself(neighbor_pe)) <span class="keywordflow">continue</span>; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                    </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> n1 = mybpd[dim_other1face];</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> n2 = mybpd[dim_other2face];</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> NFACEBLOCK = NC * thickness[dface][s] * blocksize[dim_other1face] * blocksize[dim_other2face];</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                    </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    <span class="keywordtype">int</span> face_start[3];</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    face_start[dface] = (1-s)*blockstart[dface] + s*(blockend[dface]-thickness[dface][s]);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                    face_start[dim_other1face] = 0;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                    face_start[dim_other2face] = 0;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                    </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                    <span class="keywordtype">int</span> face_end[3];</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                    face_end[dface] = (1-s)*(blockstart[dface] + thickness[dface][s]) + s*blockend[dface];</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                    face_end[dim_other1face] = blocksize[dim_other1face];</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                    face_end[dim_other2face] = blocksize[dim_other2face];</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                    assert(NFACEBLOCK == NC*(face_end[0]-face_start[0])*(face_end[1]-face_start[1])*(face_end[2]-face_start[2]));</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                    </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p2=0; p2&lt;n2; ++p2)  </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p1=0; p1&lt;n1; ++p1) <span class="comment">//iterate over inner face blocks </span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                        {   </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                            <span class="keywordtype">int</span> index[3];</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                            index[dface] = s*(mybpd[dface]-1);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                            index[dim_other1face] = p1 ;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                            index[dim_other2face] = p2;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                            </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                            assert(c2i.find(I3(origin[0] + index[0], origin[1] + index[1], origin[2] + index[2]))!=c2i.end());</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">int</span> blockID = c2i[I3(origin[0] + index[0], origin[1] + index[1], origin[2] + index[2])];</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                            <a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> * <span class="keyword">const</span> ptrBlock = (<a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a>*)globalinfos[blockID].ptrBlock;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                            </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> dedge=0; dedge&lt;3; ++dedge) <span class="comment">//iterate over edges</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                            {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other1edge = (dedge+1)%3;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                                <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other2edge = (dedge+2)%3;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                                </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=0; b&lt;2; ++b)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> a=0; a&lt;2; ++a)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                                {                                   </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                    {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                                        <span class="keywordtype">int</span> asd[3];</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                        asd[dedge] = 0;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                                        asd[dim_other1edge] = a;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                        asd[dim_other2edge] = b;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                        </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                                        <span class="keywordflow">if</span> (dedge==dface || asd[dface] != s) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                                    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                                    </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                                    <span class="keywordtype">int</span> start[3];</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                                    start[dedge] = 0;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                    start[dim_other1edge] = blockstart[dim_other1edge]*(1-a) + a*(blockend[dim_other1edge]-thickness[dim_other1edge][1]);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                                    start[dim_other2edge] = blockstart[dim_other2edge]*(1-b) + b*(blockend[dim_other2edge]-thickness[dim_other2edge][1]);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                    </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                                    <span class="keywordtype">int</span> end[3];</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                    end[dedge] = blocksize[dedge];</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                    end[dim_other1edge] = a*blockend[dim_other1edge] + (1-a)*(blockstart[dim_other1edge] + thickness[dim_other1edge][0]);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                    end[dim_other2edge] = b*blockend[dim_other2edge] + (1-b)*(blockstart[dim_other2edge] + thickness[dim_other2edge][0]);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                                    </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">int</span> vol = max(0, end[2]-start[2])*max(0, end[1]-start[1])*max(0, end[0]-start[0]);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                                    <span class="keywordflow">if</span> (vol == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                                    </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                                    <span class="keywordtype">int</span> xxx[3];</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                                    xxx[dedge] = 0;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                                    xxx[dim_other1edge] = 2*a-1;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                                    xxx[dim_other2edge] = 2*b-1;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                                    </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                                    <span class="keywordtype">int</span> neighbor[3];</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                                    neighbor[dface] = index[dface]; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                                    neighbor[dedge] = index[dedge];</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                                    neighbor[3-dface-dedge] = index[3-dface-dedge] +  xxx[3-dface-dedge];</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                                    </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                                    <span class="keywordflow">if</span>(c2i.find(I3(origin[0] + neighbor[0], origin[1] + neighbor[1], origin[2] + neighbor[2]))==c2i.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                                    </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                                    assert(n1 &gt; neighbor[dim_other1face]);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                                    assert(n2 &gt; neighbor[dim_other2face]);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                                    assert(0 &lt;= neighbor[dim_other1face]);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                                    assert(0 &lt;= neighbor[dim_other2face]);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                                    </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                                    {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">int</span> sregion[3] = {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                                            start[0]  + (index[0] - neighbor[0])*blocksize[0] - face_start[0],</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                                            start[1]  + (index[1] - neighbor[1])*blocksize[1] - face_start[1],</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                            start[2]  + (index[2] - neighbor[2])*blocksize[2] - face_start[2]</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                        };</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                                        </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">int</span> L[3] = {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                                            face_end[0] - face_start[0],</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                            face_end[1] - face_start[1],</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                                            face_end[2] - face_start[2]</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                                        };</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                                        </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                                        <span class="comment">//if (isroot)</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">//                                      {</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">//                                          printf(&quot;-----EDGE ---------------&gt;  index: %d %d %d\n&quot;, index[0], index[1], index[2]);</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">//                                          printf(&quot;neighbor: %d %d %d\n&quot;, neighbor[0], neighbor[1], neighbor[2]);</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">//                                          printf(&quot;face: %d %d\n&quot;, dface, s);</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">//                                          printf(&quot;edge: %d %d %d\n&quot;, dedge, a, b);</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">//                                          printf(&quot;facestart: %d %d %d\n&quot;, face_start[0], face_start[1], face_start[2]);</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">//                                          printf(&quot;mystart-end: %d %d %d , %d %d %d\n&quot;, start[0], start[1], start[2],  end[0], end[1], end[2]);</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">//                                          printf(&quot;s: %d %d %d\n&quot;,sregion[0], sregion[1], sregion[2]);</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">//                                          printf(&quot;L: %d %d %d\n&quot;,L[0], L[1], L[2]);</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">//                                          printf(&quot;neighbor p1, p2: %d %d\n&quot;, neighbor[dim_other1face], neighbor[dim_other2face]);</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">//                                      }</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                                        </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                                        assert(sregion[0]&gt;= 0);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                                        assert(sregion[1]&gt;= 0);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                                        assert(sregion[2]&gt;= 0);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                                        </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                                        assert(sregion[0]&lt; L[0]);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                                        assert(sregion[1]&lt; L[1]);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                        assert(sregion[2]&lt; L[2]);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                                        <a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> * src_base = data.faces[dface][s] + NFACEBLOCK*(neighbor[dim_other1face] + n1*neighbor[dim_other2face]);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                                        SubpackInfo subinfo = { ptrBlock, src_base, </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                                                start[0], start[1], start[2], end[0], end[1], end[2], </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                                                sregion[0], sregion[1], sregion[2], L[0], L[1]};</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                                        </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                                        retval[ptrBlock].push_back(subinfo);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                                    }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                            }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                            </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                            <span class="comment">//iterate over corners</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> z=0; z&lt;2; ++z)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0; y&lt;2; ++y)</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x=0; x&lt;2; ++x)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                            {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                                <span class="keywordtype">int</span> xxx[3] = {x,y,z};</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                                <span class="keywordflow">if</span> (xxx[dface] != s) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                                </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                                <span class="keyword">const</span> <span class="keywordtype">int</span> start[3] = {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                                    x*(blockend[0] - thickness[0][1]) + (1-x)*blockstart[0],</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                                    y*(blockend[1] - thickness[1][1]) + (1-y)*blockstart[1],</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                                    z*(blockend[2] - thickness[2][1]) + (1-z)*blockstart[2]</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                                };</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                                </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                                <span class="keyword">const</span> <span class="keywordtype">int</span> end[3] = {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                    x*blockend[0] + (1-x)*(thickness[0][0] + blockstart[0]),</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                    y*blockend[1] + (1-y)*(thickness[1][0] + blockstart[1]),</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                    z*blockend[2] + (1-z)*(thickness[2][0] + blockstart[2])</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                                };</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                                </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                                <span class="keyword">const</span> <span class="keywordtype">int</span> vol = max(0, end[2]-start[2])*max(0, end[1]-start[1])*max(0, end[0]-start[0]);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                                <span class="keywordflow">if</span> (vol == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                                </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                                <span class="keywordtype">int</span> neighbor[3];</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                                neighbor[0] = index[0] + 2*x-1; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                                neighbor[1] = index[1] + 2*y-1;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                neighbor[2] = index[2] + 2*z-1;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                                neighbor[dface] = index[dface];</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                                </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                <span class="keywordflow">if</span>(c2i.find(I3(origin[0] + neighbor[0], origin[1] + neighbor[1], origin[2] + neighbor[2]))==c2i.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                                assert(n1 &gt; neighbor[dim_other1face]);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                assert(n2 &gt; neighbor[dim_other2face]);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                                assert(0 &lt;= neighbor[dim_other1face]);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                                assert(0 &lt;= neighbor[dim_other2face]);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                                {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">int</span> sregion[3] = {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                                        start[0]  + (index[0] - neighbor[0])*blocksize[0] - face_start[0],</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                                        start[1]  + (index[1] - neighbor[1])*blocksize[1] - face_start[1],</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                                        start[2]  + (index[2] - neighbor[2])*blocksize[2] - face_start[2]</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                                    };</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                                    </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">int</span> L[3] = {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                        face_end[0] - face_start[0],</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                                        face_end[1] - face_start[1],</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                                        face_end[2] - face_start[2]</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                                    };</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                                    </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                                <span class="comment">//  if (isroot)</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">//                                  {</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">//                                      printf(&quot;---CORNER -----------------&gt;  index: %d %d %d\n&quot;, index[0], index[1], index[2]);</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">//                                      printf(&quot;neighbor: %d %d %d\n&quot;, neighbor[0], neighbor[1], neighbor[2]);</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">//                                      printf(&quot;face: %d %d\n&quot;, dface, s);</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">//                                      printf(&quot;corner: %d %d %d\n&quot;, x, y, z);</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">//                                      printf(&quot;facestart: %d %d %d\n&quot;, face_start[0], face_start[1], face_start[2]);</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">//                                      printf(&quot;mystart: %d %d %d\n&quot;, start[0], start[1], start[2]);</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">//                                      printf(&quot;s: %d %d %d\n&quot;,sregion[0], sregion[1], sregion[2]);</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">//                                      printf(&quot;L: %d %d %d\n&quot;,L[0], L[1], L[2]);</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">//                                      printf(&quot;neighbor p1, p2: %d %d\n&quot;, neighbor[dim_other1face], neighbor[dim_other2face]);</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">//                                  }</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                                    assert(c2i.find(I3(origin[0] + neighbor[0], origin[1] + neighbor[1], origin[2] + neighbor[2]))!=c2i.end());</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                                    assert(sregion[0]&gt;= 0);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                                    assert(sregion[1]&gt;= 0);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                                    assert(sregion[2]&gt;= 0);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                                    </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                                    assert(sregion[0]&lt; L[0]);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                                    assert(sregion[1]&lt; L[1]);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                                    assert(sregion[2]&lt; L[2]);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                                    </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                                    <a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> * src_base = data.faces[dface][s] + NFACEBLOCK*(neighbor[dim_other1face] + n1*neighbor[dim_other2face]);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                                    </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                                    SubpackInfo subinfo = { ptrBlock, src_base, </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                                        start[0], start[1], start[2], end[0], end[1], end[2], </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                                        sregion[0], sregion[1], sregion[2], L[0], L[1]};</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                                    </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                                    retval[ptrBlock].push_back(subinfo);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                                }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                            }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                        }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0; d&lt;3; ++d)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other1 = (d+1)%3;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other2 = (d+2)%3;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=0; b&lt;2; ++b)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> a=0; a&lt;2; ++a)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                    {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                        {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                            <span class="keywordtype">int</span> neighbor_pe[3];</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                            neighbor_pe[d] = mypeindex[d];</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                            neighbor_pe[dim_other1] = (mypeindex[dim_other1] + 2*a-1 + pesize[dim_other1])%pesize[dim_other1];</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                            neighbor_pe[dim_other2] = (mypeindex[dim_other2] + 2*b-1 + pesize[dim_other2])%pesize[dim_other2];</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                            </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                            <span class="keywordflow">if</span> (_myself(neighbor_pe)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                        }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                        </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">int</span> n = bpd[d];</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">int</span> NEDGEBLOCK = NC * blocksize[d] * thickness[dim_other2][b] * thickness[dim_other1][a];</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                        </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                        <span class="keywordtype">int</span> edge_start[3];</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                        edge_start[d] = 0;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                        edge_start[dim_other1] = blockstart[dim_other1]*(1-a) + a*(blockend[dim_other1]-thickness[dim_other1][1]);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                        edge_start[dim_other2] = blockstart[dim_other2]*(1-b) + b*(blockend[dim_other2]-thickness[dim_other2][1]);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                        </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                        <span class="keywordtype">int</span> edge_end[3];</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                        edge_end[d] = blocksize[d];</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                        edge_end[dim_other1] = a*blockend[dim_other1] + (1-a)*(blockstart[dim_other1] + thickness[dim_other1][0]);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                        edge_end[dim_other2] = b*blockend[dim_other2] + (1-b)*(blockstart[dim_other2] + thickness[dim_other2][0]);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                        </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                        assert(NEDGEBLOCK == NC*(edge_end[0]-edge_start[0])*(edge_end[1]-edge_start[1])*(edge_end[2]-edge_start[2]));</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> p1=0; p1&lt;n; ++p1) <span class="comment">//iterate over inner edge blocks</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                        {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                            <span class="keywordtype">int</span> index[3];</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                            index[d] = p1;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                            index[dim_other1] = a*(bpd[dim_other1]-1);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                            index[dim_other2] = b*(bpd[dim_other2]-1);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                            </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                            assert(c2i.find(I3(origin[0] + index[0], origin[1] + index[1], origin[2] + index[2]))!=c2i.end());</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">int</span> blockID = c2i[I3(origin[0] + index[0], origin[1] + index[1], origin[2] + index[2])];</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                            <a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> * <span class="keyword">const</span> ptrBlock = (<a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a>*)globalinfos[blockID].ptrBlock;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                            </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> z=0; z&lt;2; ++z) <span class="comment">//iterate over corners</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0; y&lt;2; ++y)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x=0; x&lt;2; ++x)</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                                    {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                                        <span class="keywordtype">int</span> xxx[3] = {x,y,z};</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                                        <span class="keywordflow">if</span> (xxx[dim_other1] != a || xxx[dim_other2] != b) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                                        </div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">int</span> start[3] = {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                                            x*(blockend[0] - thickness[0][1]) + (1-x)*blockstart[0],</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                                            y*(blockend[1] - thickness[1][1]) + (1-y)*blockstart[1],</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                                            z*(blockend[2] - thickness[2][1]) + (1-z)*blockstart[2]</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                                        };</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                                        </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">int</span> end[3] = {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                                            x*blockend[0] + (1-x)*(thickness[0][0] + blockstart[0]),</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                                            y*blockend[1] + (1-y)*(thickness[1][0] + blockstart[1]),</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                                            z*blockend[2] + (1-z)*(thickness[2][0] + blockstart[2])</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                                        };</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                                        </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">int</span> vol = max(0, end[2]-start[2])*max(0, end[1]-start[1])*max(0, end[0]-start[0]);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                                        <span class="keywordflow">if</span> (vol == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                                        </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                                        <span class="keywordtype">int</span> neighbor[3];</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                                        neighbor[0] = index[0]; </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                        neighbor[1] = index[1];</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                                        neighbor[2] = index[2];</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                                        neighbor[d] = index[d] + xxx[d]*2-1;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                                        <span class="keywordflow">if</span>(c2i.find(I3(origin[0] + neighbor[0], origin[1] + neighbor[1], origin[2] + neighbor[2]))==c2i.end()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                                        assert(n &gt; neighbor[d]);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                                        assert(0 &lt;= neighbor[d]);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                                        </div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                                        {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                                            <span class="keyword">const</span> <span class="keywordtype">int</span> sregion[3] = {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                                                start[0]  + (index[0] - neighbor[0])*blocksize[0] - edge_start[0],</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                                                start[1]  + (index[1] - neighbor[1])*blocksize[1] - edge_start[1],</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                                                start[2]  + (index[2] - neighbor[2])*blocksize[2] - edge_start[2]</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                            };</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                                            </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                            <span class="keyword">const</span> <span class="keywordtype">int</span> L[3] = {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                                                edge_end[0] - edge_start[0],</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                                                edge_end[1] - edge_start[1],</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                                                edge_end[2] - edge_start[2]</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                                            };</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                                            </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                                        <span class="comment">//  if (isroot)</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">//                                          {</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">//                                              printf(&quot;---CORNER (from edge) -----------------&gt;  index: %d %d %d\n&quot;, index[0], index[1], index[2]);</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">//                                              printf(&quot;neighbor: %d %d %d\n&quot;, neighbor[0], neighbor[1], neighbor[2]);</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">//                                              printf(&quot;edge: %d %d %d\n&quot;, d, a, b);</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">//                                              printf(&quot;corner: %d %d %d\n&quot;, x, y, z);</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">//                                              printf(&quot;edgestart: %d %d %d\n&quot;, edge_start[0], edge_start[1], edge_start[2]);</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">//                                              printf(&quot;mystart: %d %d %d\n&quot;, start[0], start[1], start[2]);</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">//                                              printf(&quot;s: %d %d %d\n&quot;,sregion[0], sregion[1], sregion[2]);</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">//                                              printf(&quot;L: %d %d %d\n&quot;,L[0], L[1], L[2]);</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">//                                              printf(&quot;neighbor p1: %d\n&quot;, neighbor[d]);</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">//                                          }</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                            assert(c2i.find(I3(origin[0] + neighbor[0], origin[1] + neighbor[1], origin[2] + neighbor[2]))!=c2i.end());</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                                            assert(sregion[0]&gt;= 0);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                                            assert(sregion[1]&gt;= 0);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                                            assert(sregion[2]&gt;= 0);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                                            </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                                            assert(sregion[0]&lt; L[0]);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                                            assert(sregion[1]&lt; L[1]);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                                            assert(sregion[2]&lt; L[2]);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                                            assert(vol &lt;NEDGEBLOCK);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                                            </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                                            <span class="comment">//Real * src_base = data.faces[dface][s] + NFACEBLOCK*(neighbor[dim_other1face] + n1*neighbor[dim_other2face]);</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                                            <a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> * src_base = data.edges[d][b][a] + NEDGEBLOCK*neighbor[d];</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                                            </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                                            SubpackInfo subinfo = { ptrBlock, src_base, </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                                                start[0], start[1], start[2], end[0], end[1], end[2],</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                                                sregion[0], sregion[1], sregion[2], L[0], L[1]};</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                                            </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                            retval[ptrBlock].push_back(subinfo);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                                        }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                                    }</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                        }                           </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                    }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        </div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="comment">//corners</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> z=0; z&lt;2; ++z)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0; y&lt;2; ++y)</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x=0; x&lt;2; ++x)</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                {                   </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> NCORNERBLOCK = NC * thickness[0][x]*thickness[1][y]*thickness[2][z];</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                    </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">bool</span> needed = NCORNERBLOCK &gt; 0;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                    data.corners[z][y][x] = needed ? _myalloc(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a>)*NCORNERBLOCK, 16) : NULL;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                    </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                    <span class="keywordflow">if</span> (!needed) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                    </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                    <span class="keywordtype">int</span> neighbor_index[3];</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                    neighbor_index[0] = (mypeindex[0] + 2*x-1 + pesize[0])%pesize[0];</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                    neighbor_index[1] = (mypeindex[1] + 2*y-1 + pesize[1])%pesize[1];</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                    neighbor_index[2] = (mypeindex[2] + 2*z-1 + pesize[2])%pesize[2];</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                    </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                    <span class="keywordflow">if</span> (_myself(neighbor_index)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                    </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> start[3] = {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                        x*(blockend[0] - thickness[0][1]) + (1-x)*blockstart[0],</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                        y*(blockend[1] - thickness[1][1]) + (1-y)*blockstart[1],</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                        z*(blockend[2] - thickness[2][1]) + (1-z)*blockstart[2]</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                    };</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                    </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> end[3] = {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                        x*blockend[0] + (1-x)*(thickness[0][0] + blockstart[0]),</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                        y*blockend[1] + (1-y)*(thickness[1][0] + blockstart[1]),</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                        z*blockend[2] + (1-z)*(thickness[2][0] + blockstart[2])</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                    };</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                    </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> index[3] = {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                        x*(bpd[0]-1),</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                        y*(bpd[1]-1),</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                        z*(bpd[2]-1),</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                    };</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                    </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                    assert(c2i.find(I3(origin[0] + index[0], origin[1] + index[1], origin[2] + index[2]))!=c2i.end());</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> blockid = c2i[I3(origin[0] + index[0], origin[1] + index[1], origin[2] + index[2])];</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                    </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                    PackInfo info = {(<a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> *)globalinfos[blockid].ptrBlock, data.corners[z][y][x], start[0], start[1], start[2],  end[0], end[1], end[2]};</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                    </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">bool</span> nonempty = end[0]&gt;start[0] &amp;&amp; end[1]&gt;start[1] &amp;&amp; end[2]&gt;start[2];</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                    <span class="keywordflow">if</span> (nonempty) packinfos.push_back(info);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="keywordflow">return</span> retval;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> * _myalloc(<span class="keyword">const</span> <span class="keywordtype">int</span> NBYTES, <span class="keyword">const</span> <span class="keywordtype">int</span> ALIGN) </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keywordflow">if</span> (NBYTES&gt;0)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="comment">//Real * ret_val = (Real *)_mm_malloc(NBYTES, ALIGN);</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            <a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> * ret_val = NULL;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <span class="keywordtype">int</span> error = posix_memalign((<span class="keywordtype">void</span>**)&amp;ret_val, std::max(8, ALIGN), NBYTES);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            assert(error == 0);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;     </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            all_mallocs.push_back(ret_val);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordflow">return</span> ret_val;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        }</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        </div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordtype">void</span> _myfree(<a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> *&amp; ptr) {<span class="keywordflow">if</span> (ptr!=NULL) { free(ptr); ptr=NULL;} }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">//forbidden methods</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html">SynchronizerMPI</a>(<span class="keyword">const</span> <a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html">SynchronizerMPI</a>&amp; c):cube(-1,-1,-1), synchID(-1), isroot(<span class="keyword">true</span>){ abort(); }</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    </div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordtype">void</span> operator=(<span class="keyword">const</span> <a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html">SynchronizerMPI</a>&amp; c){ abort(); }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    </div>
<div class="line"><a name="l00648"></a><span class="lineno"><a class="line" href="../../d0/ddf/class_synchronizer_m_p_i.html#a361cd2e7121eec06007dedc5cae65278">  648</a></span>&#160;    <a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html#a361cd2e7121eec06007dedc5cae65278">SynchronizerMPI</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> synchID, <a class="code" href="../../da/d04/struct_stencil_info.html">StencilInfo</a> stencil, vector&lt;BlockInfo&gt; globalinfos, MPI::Cartcomm cartcomm, <span class="keyword">const</span> <span class="keywordtype">int</span> mybpd[3], <span class="keyword">const</span> <span class="keywordtype">int</span> blocksize[3]): </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    synchID(synchID), stencil(stencil), globalinfos(globalinfos), cube(mybpd[0], mybpd[1], mybpd[2]), isroot(MPI::COMM_WORLD.Get_rank() == 0), cartcomm(cartcomm)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    {           </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        cartcomm.Get_topo(3, pesize, periodic, mypeindex);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> myrank = cartcomm.Get_rank();</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        cartcomm.Get_coords(myrank, 3, mypeindex);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iz=0; iz&lt;3; iz++)</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iy=0; iy&lt;3; iy++)</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ix=0; ix&lt;3; ix++)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                {</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> s[3] = { ix-1+mypeindex[0], iy-1+mypeindex[1], iz-1+mypeindex[2]};</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                    neighborsrank[iz][iy][ix] = cartcomm.Get_cart_rank(s);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                }</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;3; ++i) this-&gt;mybpd[i]=mybpd[i];</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;3; ++i) this-&gt;blocksize[i]=blocksize[i];</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        </div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; globalinfos.size(); ++i)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            I3 coord(globalinfos[i].index[0], globalinfos[i].index[1], globalinfos[i].index[2]);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            c2i[coord] = i;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        </div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> origin[3] = { </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            mypeindex[0]*mybpd[0],</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            mypeindex[1]*mybpd[1],</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            mypeindex[2]*mybpd[2]</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        };</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> s[3] = {stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#acbfb2d23b2b10177dd846173a299b847">sx</a>, stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a4f024cdf41fca32720321fa95bd2a8bd">sy</a>, stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a00e8cbf611bbb74ad861a6d74b6d0d9f">sz</a>};</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> e[3] = {stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a5eddf6f1b64ce03fc84e6e447e4d500f">ex</a>, stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a584955f3761b5854a9050c97cba3c3ca">ey</a>, stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#afbdda2df54c6af8e9e8b8536e6e31bdc">ez</a>};</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> z[3] = {0, 0, 0};</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        send_thickness[0][0] = e[0] - 1;  send_thickness[0][1] = -s[0];</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        send_thickness[1][0] = e[1] - 1;  send_thickness[1][1] = -s[1];</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        send_thickness[2][0] = e[2] - 1;  send_thickness[2][1] = -s[2];</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        _setup&lt;false&gt;(send, send_thickness, z, blocksize, origin, send_packinfos);  </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        recv_thickness[0][0] = -s[0]; recv_thickness[0][1] = e[0] - 1; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        recv_thickness[1][0] = -s[1]; recv_thickness[1][1] = e[1] - 1; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        recv_thickness[2][0] = -s[2]; recv_thickness[2][1] = e[2] - 1; </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> blockstart[3] = {</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#acbfb2d23b2b10177dd846173a299b847">sx</a> , </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a4f024cdf41fca32720321fa95bd2a8bd">sy</a> , </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a00e8cbf611bbb74ad861a6d74b6d0d9f">sz</a>  </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            };</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> blockend[3] = {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a5eddf6f1b64ce03fc84e6e447e4d500f">ex</a> + blocksize[0]-1, </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a584955f3761b5854a9050c97cba3c3ca">ey</a> + blocksize[1]-1, </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#afbdda2df54c6af8e9e8b8536e6e31bdc">ez</a> + blocksize[2]-1 </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            };</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            vector&lt;PackInfo&gt; packinfos;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            recv_subpackinfos = _setup&lt;true&gt;(recv, recv_thickness, blockstart, blockend, origin, packinfos);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            <span class="keywordflow">for</span>(vector&lt;PackInfo&gt;::const_iterator it = packinfos.begin(); it&lt;packinfos.end(); ++it)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                recv_packinfos[it-&gt;block].push_back(*it);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        assert(recv.pending.size() == 0);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        assert(send.pending.size() == 0);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    </div>
<div class="line"><a name="l00717"></a><span class="lineno"><a class="line" href="../../d0/ddf/class_synchronizer_m_p_i.html#a783e782e542e65144eda9105ae986e3b">  717</a></span>&#160;    <a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html#a783e782e542e65144eda9105ae986e3b">~SynchronizerMPI</a>()</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;all_mallocs.size();++i)</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            _myfree(all_mallocs[i]);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    }</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    </div>
<div class="line"><a name="l00723"></a><span class="lineno"><a class="line" href="../../d0/ddf/class_synchronizer_m_p_i.html#a34c0550eac39387ac5e1d826aab3300e">  723</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html#a34c0550eac39387ac5e1d826aab3300e">sync</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gptfloats, MPI::Datatype MPIREAL, <span class="keyword">const</span> <span class="keywordtype">int</span> timestamp)</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="comment">//0. wait for pending sends, couple of checks</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="comment">//1. pack all stuff</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <span class="comment">//2. perform send/receive requests</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="comment">//3. setup the dependency</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="comment">//0.</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> NPENDINGSENDS = send.pending.size();</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <span class="keywordflow">if</span> (NPENDINGSENDS &gt; 0)</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                vector&lt;MPI::Request&gt; pending(NPENDINGSENDS);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                copy(send.pending.begin(), send.pending.end(), pending.begin());</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                MPI::Request::Waitall(NPENDINGSENDS, &amp;pending.front());</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                send.pending.clear();</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            }</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        }</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        assert(recv.pending.size() == 0);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        assert(send.pending.size() == 0);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        cube.<a class="code" href="../../d3/d21/class_dependency_cube_m_p_i.html#abd4e8187ccfe651ded18f8c5c10fa691">prepare</a>();</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        blockinfo_counter = globalinfos.size();</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> NC = stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a6a07ebcb676dabaadf000e1348b8c016">selcomponents</a>.size();</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="comment">//1. pack</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        {</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> N = send_packinfos.size();</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            vector&lt;int&gt; selcomponents = stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a6a07ebcb676dabaadf000e1348b8c016">selcomponents</a>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            sort(selcomponents.begin(), selcomponents.end());</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> contiguous = <span class="keyword">false</span>;<span class="comment">//selcomponents.back()+1-selcomponents.front() == selcomponents.size();</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <span class="keywordflow">if</span> (!contiguous)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="preprocessor">#pragma omp parallel for</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;N; ++i)</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                    PackInfo info = send_packinfos[i];</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                    <a class="code" href="../../d7/dd2/_p_u_pkernels_m_p_i_8h.html#a7a485735d2946aa4b92203577ff84081">pack</a>(info.block, info.pack, gptfloats, &amp;selcomponents.front(), NC, info.sx, info.sy, info.sz, info.ex, info.ey, info.ez);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                }</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            }</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="keywordflow">else</span> </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            {</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> selstart = selcomponents.front();</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> selend = selcomponents.back()+1;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                </div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="preprocessor">#pragma omp parallel for</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;N; ++i)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                    PackInfo info = send_packinfos[i];</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                    <a class="code" href="../../d7/dd2/_p_u_pkernels_m_p_i_8h.html#ae1600280d9525d09b4d580fbf4ed81db">pack_stripes</a>(info.block, info.pack, gptfloats, selstart, selend, info.sx, info.sy, info.sz, info.ex, info.ey, info.ez);</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="comment">//2. send requests</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            <span class="comment">//faces</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0; d&lt;3; ++d)</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            {</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                <span class="keywordflow">if</span> (!_face_needed(d)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other1 = (d+1)%3;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other2 = (d+2)%3;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0; s&lt;2; ++s)</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                {</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> NFACEBLOCK_SEND = NC * send_thickness[d][s] * blocksize[dim_other1] * blocksize[dim_other2];</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> NFACEBLOCK_RECV = NC * recv_thickness[d][s] * blocksize[dim_other1] * blocksize[dim_other2];</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> NFACE_SEND = NFACEBLOCK_SEND * mybpd[dim_other1] * mybpd[dim_other2];</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> NFACE_RECV = NFACEBLOCK_RECV * mybpd[dim_other1] * mybpd[dim_other2];</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                    </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                    <span class="keywordtype">int</span> neighbor_index[3];</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                    neighbor_index[d] = (mypeindex[d] + 2*s-1 + pesize[d])%pesize[d];</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                    neighbor_index[dim_other1] = mypeindex[dim_other1];</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                    neighbor_index[dim_other2] = mypeindex[dim_other2];</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                    </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                    <span class="keywordflow">if</span> (_myself(neighbor_index)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                    </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                    <span class="keywordflow">if</span> (NFACE_RECV &gt; 0)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                    {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                        MPI::Request rc = cartcomm.Irecv(recv.faces[d][s], NFACE_RECV, MPIREAL, _rank(neighbor_index), 6*timestamp + 2*d + s);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                        recv.pending.insert(rc);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                        cube.<a class="code" href="../../d3/d21/class_dependency_cube_m_p_i.html#a057adc047896117c998e5709d8a83d43">face</a>(rc, d, s);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                    }</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                    <span class="keywordflow">if</span> (NFACE_SEND &gt; 0)</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                      send.pending.insert( cartcomm.Isend(send.faces[d][s], NFACE_SEND, MPIREAL, _rank(neighbor_index), 6*timestamp + 2*d + 1-s) );</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                }</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            <span class="keywordflow">if</span> (stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#ab3fce74853afec119eee90a6274d1559">tensorial</a>)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            {</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                <span class="comment">//edges</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> d=0; d&lt;3; ++d)</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                {</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other1 = (d+1)%3;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> dim_other2 = (d+2)%3;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                                        </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> b=0; b&lt;2; ++b)</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> a=0; a&lt;2; ++a)</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                        {</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">int</span> NEDGEBLOCK_SEND = NC * blocksize[d] * send_thickness[dim_other2][b] * send_thickness[dim_other1][a];</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">int</span> NEDGEBLOCK_RECV = NC * blocksize[d] * recv_thickness[dim_other2][b] * recv_thickness[dim_other1][a];</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">int</span> NEDGE_SEND = NEDGEBLOCK_SEND * mybpd[d];</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">int</span> NEDGE_RECV = NEDGEBLOCK_RECV * mybpd[d];</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                            </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                            <span class="keywordtype">int</span> neighbor_index[3];</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                            neighbor_index[d] = mypeindex[d];</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                            neighbor_index[dim_other1] = (mypeindex[dim_other1] + 2*a-1 + pesize[dim_other1])%pesize[dim_other1];</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                            neighbor_index[dim_other2] = (mypeindex[dim_other2] + 2*b-1 + pesize[dim_other2])%pesize[dim_other2];</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                            </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                            <span class="keywordflow">if</span> (_myself(neighbor_index)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                            </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                            <span class="keywordflow">if</span> (NEDGE_RECV &gt; 0)</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                            {</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                                MPI::Request rc = cartcomm.Irecv(recv.edges[d][b][a], NEDGE_RECV, MPIREAL, _rank(neighbor_index), 12*timestamp + 4*d + 2*b + a);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                                </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                                recv.pending.insert(rc);</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                                </div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                                cube.<a class="code" href="../../d3/d21/class_dependency_cube_m_p_i.html#a3c346f1108cb4f571a250b5a6e3cd868">edge</a>(rc, d, a, b);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                            }</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                                                        <span class="keywordflow">if</span> (NEDGE_SEND &gt; 0)</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                              send.pending.insert( cartcomm.Isend(send.edges[d][b][a], NEDGE_SEND, MPIREAL, _rank(neighbor_index), 12*timestamp + 4*d + 2*(1-b) + (1-a)));</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                        }</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                }</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                </div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                <span class="comment">//corners</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                {</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> z=0; z&lt;2; ++z)</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0; y&lt;2; ++y)</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x=0; x&lt;2; ++x)</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                                {                               </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">int</span> NCORNERBLOCK_SEND = NC * send_thickness[0][x]*send_thickness[1][y]*send_thickness[2][z];</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">int</span> NCORNERBLOCK_RECV = NC * recv_thickness[0][x]*recv_thickness[1][y]*recv_thickness[2][z];</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                                    </div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                                    <span class="keywordtype">int</span> neighbor_index[3];</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                                    neighbor_index[0] = (mypeindex[0] + 2*x-1 + pesize[0])%pesize[0];</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                                    neighbor_index[1] = (mypeindex[1] + 2*y-1 + pesize[1])%pesize[1];</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                                    neighbor_index[2] = (mypeindex[2] + 2*z-1 + pesize[2])%pesize[2];</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                                    </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                                    <span class="keywordflow">if</span> (_myself(neighbor_index)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                                    </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                                    <span class="keywordflow">if</span> (NCORNERBLOCK_RECV)</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                                    {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                                        MPI::Request rc = cartcomm.Irecv(recv.corners[z][y][x], NCORNERBLOCK_RECV, MPIREAL, _rank(neighbor_index), 8*timestamp + 4*z + 2*y + x);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                                        </div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                                        recv.pending.insert(rc);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                                        </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                                        cube.<a class="code" href="../../d3/d21/class_dependency_cube_m_p_i.html#a797a6e9d3cb5d7edf9439f4abbf27b05">corner</a>(rc, x, y, z);</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                                    }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                                    <span class="keywordflow">if</span> (NCORNERBLOCK_SEND)</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                                      send.pending.insert( cartcomm.Isend(send.corners[z][y][x], NCORNERBLOCK_SEND, MPIREAL, _rank(neighbor_index), 8*timestamp + 4*(1-z) + 2*(1-y) + (1-x)) \</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                                   );</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                                }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            }</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="comment">//3.</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        cube.<a class="code" href="../../d3/d21/class_dependency_cube_m_p_i.html#a65a7562678c7f9d7ab63780ffbdfac87">make_dependencies</a>(isroot);</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    }</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    </div>
<div class="line"><a name="l00892"></a><span class="lineno"><a class="line" href="../../d0/ddf/class_synchronizer_m_p_i.html#aaa3b9722374a17f0703f09b6ae8f7821">  892</a></span>&#160;    vector&lt;BlockInfo&gt; <a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html#aaa3b9722374a17f0703f09b6ae8f7821">avail</a>()</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    {        </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        vector&lt;BlockInfo&gt; retval;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> NPENDING = recv.pending.size();</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;               </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        vector&lt;MPI::Request&gt; pending(NPENDING);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        copy(recv.pending.begin(), recv.pending.end(), pending.begin());</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        vector&lt;MPI::Request&gt; old = pending;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="keywordflow">if</span>(NPENDING &gt; 0)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            <span class="keywordflow">if</span>(mybpd[0]==1 || mybpd[1]==1 || mybpd[2] == 1) <span class="comment">//IS THERE SOMETHING MORE INTELLIGENT?!</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            {</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                MPI::Request::Waitall(NPENDING, &amp;pending.front());</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;NPENDING; ++i)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                    cube.<a class="code" href="../../d3/d21/class_dependency_cube_m_p_i.html#a6b7972db814a3469a2774946ba3062a4">received</a>(old[i]);</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                    recv.pending.erase(old[i]);</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                vector&lt;int&gt; indices(NPENDING);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                <span class="keywordtype">size_t</span> NSOLVED = 0;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                <span class="keywordflow">if</span> (blockinfo_counter == globalinfos.size())</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                    NSOLVED = MPI::Request::Testsome(NPENDING, &amp;pending.front(), &amp;indices.front());</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                    NSOLVED = MPI::Request::Waitsome(NPENDING, &amp;pending.front(), &amp;indices.front());</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                    assert(NSOLVED &gt; 0);</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;NSOLVED; ++i)</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                    cube.<a class="code" href="../../d3/d21/class_dependency_cube_m_p_i.html#a6b7972db814a3469a2774946ba3062a4">received</a>(old[indices[i]]);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                    recv.pending.erase(old[indices[i]]);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        }</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> xorigin = mypeindex[0]*mybpd[0];</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> yorigin = mypeindex[1]*mybpd[1];</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> zorigin = mypeindex[2]*mybpd[2];</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        vector&lt;Region&gt; regions = cube.<a class="code" href="../../d3/d21/class_dependency_cube_m_p_i.html#a95e03004604866099b5acf0af2cf3b1a">avail</a>();</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        </div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <span class="keywordflow">for</span>(vector&lt;Region&gt;::const_iterator it=regions.begin(); it!=regions.end(); ++it)</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        {   </div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            map&lt;Region, vector&lt;BlockInfo&gt; &gt;::const_iterator r2v = region2infos.find(*it);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            <span class="keywordflow">if</span>(r2v!=region2infos.end())</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                retval.insert(retval.end(), r2v-&gt;second.begin(), r2v-&gt;second.end());</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                blockinfo_counter -=  r2v-&gt;second.size();</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            }</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            {</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                vector&lt;BlockInfo&gt; entry;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> sx = it-&gt;s[0];</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> sy = it-&gt;s[1];</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> sz = it-&gt;s[2];</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> ex = it-&gt;e[0];</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> ey = it-&gt;e[1];</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> ez = it-&gt;e[2];</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iz=sz; iz&lt;ez; ++iz)</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iy=sy; iy&lt;ey; ++iy)</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ix=sx; ix&lt;ex; ++ix, blockinfo_counter--)</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                        {</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                            assert(c2i.find(I3(ix + xorigin, iy + yorigin, iz + zorigin)) != c2i.end());</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                            entry.push_back(globalinfos[ c2i[I3(ix + xorigin, iy + yorigin, iz + zorigin)] ]);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                        }</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                </div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                retval.insert(retval.end(), entry.begin(), entry.end());</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                region2infos[*it] = entry;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;            }</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        }</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        assert(cube.<a class="code" href="../../d3/d21/class_dependency_cube_m_p_i.html#a9b187ce4ca44a150d71e55c35325afba">pendingcount</a>() != 0 || blockinfo_counter == cube.<a class="code" href="../../d3/d21/class_dependency_cube_m_p_i.html#a9b187ce4ca44a150d71e55c35325afba">pendingcount</a>());</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        assert(blockinfo_counter != 0 || blockinfo_counter == cube.<a class="code" href="../../d3/d21/class_dependency_cube_m_p_i.html#a9b187ce4ca44a150d71e55c35325afba">pendingcount</a>());</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        assert(blockinfo_counter != 0 || recv.pending.size() == 0);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        </div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <span class="keywordflow">return</span> retval;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    }</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    </div>
<div class="line"><a name="l00982"></a><span class="lineno"><a class="line" href="../../d0/ddf/class_synchronizer_m_p_i.html#a1fe2fa97907cbae0ddc874cee4462d83">  982</a></span>&#160;    vector&lt;BlockInfo&gt; <a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html#a1fe2fa97907cbae0ddc874cee4462d83">avail</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> smallest)</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    {</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        vector&lt;BlockInfo&gt; accumulator;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        </div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keywordflow">while</span>(accumulator.size()&lt;smallest &amp;&amp; !done())</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        {</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;            <span class="keyword">const</span> vector&lt;BlockInfo&gt; r = avail();</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            accumulator.insert(accumulator.end(), r.begin(), r.end());</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        }</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        </div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <span class="keywordflow">return</span> accumulator;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    }</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    </div>
<div class="line"><a name="l00996"></a><span class="lineno"><a class="line" href="../../d0/ddf/class_synchronizer_m_p_i.html#aef137611a6b701c39db613c5e9c62812">  996</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html#aef137611a6b701c39db613c5e9c62812">done</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        assert(!(blockinfo_counter == 0) || recv.pending.size() == 0);</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <span class="keywordflow">return</span> blockinfo_counter == 0;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    }</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    </div>
<div class="line"><a name="l01003"></a><span class="lineno"><a class="line" href="../../d0/ddf/class_synchronizer_m_p_i.html#a3ef18cbe8ce8ce18e7c96dbd09419e11"> 1003</a></span>&#160;    <a class="code" href="../../da/d04/struct_stencil_info.html">StencilInfo</a> <a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html#a3ef18cbe8ce8ce18e7c96dbd09419e11">getstencil</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="keywordflow">return</span> stencil;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    }</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    </div>
<div class="line"><a name="l01008"></a><span class="lineno"><a class="line" href="../../d0/ddf/class_synchronizer_m_p_i.html#ad67473ef9e13988052feef92c4c3f086"> 1008</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html#ad67473ef9e13988052feef92c4c3f086">getpedata</a>(<span class="keywordtype">int</span> mypeindex[3], <span class="keywordtype">int</span> pesize[3], <span class="keywordtype">int</span> mybpd[3])<span class="keyword"> const</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;3; ++i) mypeindex[i] = this-&gt;mypeindex[i];</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;3; ++i) pesize[i] = this-&gt;pesize[i];</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;3; ++i) mybpd[i] = this-&gt;mybpd[i];</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    }</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    </div>
<div class="line"><a name="l01015"></a><span class="lineno"><a class="line" href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html"> 1015</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html">MyRange</a></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;{</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> sx, sy, sz, ex, ey, ez;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  </div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; <span class="keyword">public</span>:</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  </div>
<div class="line"><a name="l01021"></a><span class="lineno"><a class="line" href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html#a7c67048b9d5e4b2da18c0cd4bbb26892"> 1021</a></span>&#160; <a class="code" href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html#a7c67048b9d5e4b2da18c0cd4bbb26892">MyRange</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> sx, <span class="keyword">const</span> <span class="keywordtype">int</span> ex, <span class="keyword">const</span> <span class="keywordtype">int</span> sy, <span class="keyword">const</span> <span class="keywordtype">int</span> ey, <span class="keyword">const</span> <span class="keywordtype">int</span> sz, <span class="keyword">const</span> <span class="keywordtype">int</span> ez):</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  sx(sx), sy(sy), sz(sz), ex(ex), ey(ey), ez(ez) { }</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  </div>
<div class="line"><a name="l01025"></a><span class="lineno"><a class="line" href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html#ad6983d8512541933b4d057bbb2e99700"> 1025</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html#ad6983d8512541933b4d057bbb2e99700">outside</a>(<a class="code" href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html">MyRange</a> range)<span class="keyword"> const</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="keyword">  </span>{</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> x0 = max(sx, range.sx);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> y0 = max(sy, range.sy);</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> z0 = max(sz, range.sz);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> x1 = min(ex, range.ex);</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> y1 = min(ey, range.ey);</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> z1 = min(ez, range.ez);</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    </div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keywordflow">return</span> (x0 &gt;= x1) || (y0 &gt;= y1) || (z0 &gt;= z1);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  }</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;};</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div>
<div class="line"><a name="l01038"></a><span class="lineno"><a class="line" href="../../d0/ddf/class_synchronizer_m_p_i.html#abac3624b538d4968e1953a2aee32d449"> 1038</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d0/ddf/class_synchronizer_m_p_i.html#abac3624b538d4968e1953a2aee32d449">fetch</a>(<span class="keyword">const</span> <a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> * <span class="keyword">const</span> ptrBlock, <a class="code" href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a> * <span class="keyword">const</span> ptrLab, <span class="keyword">const</span> <span class="keywordtype">int</span> x0, <span class="keyword">const</span> <span class="keywordtype">int</span> y0, <span class="keyword">const</span> <span class="keywordtype">int</span> z0,</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;           <span class="keyword">const</span> <span class="keywordtype">int</span> xsize, <span class="keyword">const</span> <span class="keywordtype">int</span> ysize, <span class="keyword">const</span> <span class="keywordtype">int</span> zsize, <span class="keyword">const</span> <span class="keywordtype">int</span> gptfloats, <span class="keyword">const</span> <span class="keywordtype">int</span> rsx, <span class="keyword">const</span> <span class="keywordtype">int</span> rex, <span class="keyword">const</span> <span class="keywordtype">int</span> rsy, <span class="keyword">const</span> <span class="keywordtype">int</span> rey, <span class="keyword">const</span> <span class="keywordtype">int</span> rsz, <span class="keyword">const</span> <span class="keywordtype">int</span> rez)<span class="keyword"> const </span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="keyword">    </span>{</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <span class="comment">//build range</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <a class="code" href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html">MyRange</a> myrange(rsx, rex, rsy, rey, rsz, rez);</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        <span class="comment">//packs</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        {</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            map&lt;Real *, vector&lt;PackInfo&gt; &gt;::const_iterator it = recv_packinfos.find(const_cast&lt;Real *&gt;(ptrBlock));</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;            <span class="keywordflow">if</span>( it!=recv_packinfos.end() )</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            {</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                vector&lt;PackInfo&gt; packs = it-&gt;second;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                                </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                <span class="comment">//assert(!stencil.tensorial || packs.size() &lt;= 7 || mybpd[0]*mybpd[1]*mybpd[2] == 1);</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                <span class="comment">//assert(stencil.tensorial || packs.size()&lt;=3 || mybpd[0]*mybpd[1]*mybpd[2] == 1);</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                <span class="keywordflow">for</span>(vector&lt;PackInfo&gt;::const_iterator itpack=packs.begin(); itpack!=packs.end(); ++itpack)</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                {</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                  <a class="code" href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html">MyRange</a> packrange(itpack-&gt;sx, itpack-&gt;ex, itpack-&gt;sy, itpack-&gt;ey, itpack-&gt;sz, itpack-&gt;ez);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                  <span class="keywordflow">if</span> (myrange.<a class="code" href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html#ad6983d8512541933b4d057bbb2e99700">outside</a>(packrange)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> nsrc = (itpack-&gt;ex-itpack-&gt;sx)*(itpack-&gt;ey-itpack-&gt;sy)*(itpack-&gt;ez-itpack-&gt;sz);</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                    </div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                    <a class="code" href="../../d7/dd2/_p_u_pkernels_m_p_i_8h.html#a8b5aa2551611fcb7d92dda8966cbbda3">unpack</a>(itpack-&gt;pack, ptrLab, gptfloats, &amp;stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a6a07ebcb676dabaadf000e1348b8c016">selcomponents</a>.front(), stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a6a07ebcb676dabaadf000e1348b8c016">selcomponents</a>.size(), nsrc,</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                           itpack-&gt;sx-x0, itpack-&gt;sy-y0, itpack-&gt;sz-z0, </div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                           itpack-&gt;ex-x0, itpack-&gt;ey-y0, itpack-&gt;ez-z0, </div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                           xsize, ysize, zsize);</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                }</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;            } </div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        }</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="comment">//subregions inside packs</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        <span class="keywordflow">if</span> (stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#ab3fce74853afec119eee90a6274d1559">tensorial</a>)</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        {</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            map&lt;Real *, vector&lt;SubpackInfo&gt; &gt;::const_iterator it = recv_subpackinfos.find(const_cast&lt;Real *&gt;(ptrBlock));</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            assert(stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#ab3fce74853afec119eee90a6274d1559">tensorial</a> || it==recv_subpackinfos.end());</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            <span class="keywordflow">if</span>( it!=recv_subpackinfos.end() )</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            {</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                vector&lt;SubpackInfo&gt; subpacks = it-&gt;second;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    </div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <span class="comment">//  assert(subpacks.size()&lt;=12+8);</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                </div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                <span class="keywordflow">for</span>(vector&lt;SubpackInfo&gt;::const_iterator itsubpack=subpacks.begin(); itsubpack!=subpacks.end(); ++itsubpack)</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                  {</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                    <a class="code" href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html">MyRange</a> packrange(itsubpack-&gt;sx, itsubpack-&gt;ex, itsubpack-&gt;sy, itsubpack-&gt;ey, itsubpack-&gt;sz, itsubpack-&gt;ez);</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                    <span class="keywordflow">if</span> (myrange.<a class="code" href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html#ad6983d8512541933b4d057bbb2e99700">outside</a>(packrange)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                    <a class="code" href="../../d7/dd2/_p_u_pkernels_m_p_i_8h.html#a0d024fa525007ee6941795fb3f66f92d">unpack_subregion</a>(itsubpack-&gt;pack, ptrLab, gptfloats, &amp;stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a6a07ebcb676dabaadf000e1348b8c016">selcomponents</a>.front(), stencil.<a class="code" href="../../da/d04/struct_stencil_info.html#a6a07ebcb676dabaadf000e1348b8c016">selcomponents</a>.size(), </div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                                     itsubpack-&gt;x0, itsubpack-&gt;y0, itsubpack-&gt;z0,</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                                     itsubpack-&gt;xpacklenght, itsubpack-&gt;ypacklenght,</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                                     itsubpack-&gt;sx-x0, itsubpack-&gt;sy-y0, itsubpack-&gt;sz-z0, </div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                                     itsubpack-&gt;ex-x0, itsubpack-&gt;ey-y0, itsubpack-&gt;ez-z0, </div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                                     xsize, ysize, zsize);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                  }</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            } </div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        }       </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    }</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;};</div>
<div class="ttc" id="struct_stencil_info_html_acbfb2d23b2b10177dd846173a299b847"><div class="ttname"><a href="../../da/d04/struct_stencil_info.html#acbfb2d23b2b10177dd846173a299b847">StencilInfo::sx</a></div><div class="ttdeci">int sx</div><div class="ttdef"><b>Definition:</b> StencilInfo.h:19</div></div>
<div class="ttc" id="class_dependency_cube_m_p_i_html"><div class="ttname"><a href="../../d3/d21/class_dependency_cube_m_p_i.html">DependencyCubeMPI&lt; MPI::Request &gt;</a></div></div>
<div class="ttc" id="class_synchronizer_m_p_i_html_a34c0550eac39387ac5e1d826aab3300e"><div class="ttname"><a href="../../d0/ddf/class_synchronizer_m_p_i.html#a34c0550eac39387ac5e1d826aab3300e">SynchronizerMPI::sync</a></div><div class="ttdeci">virtual void sync(unsigned int gptfloats, MPI::Datatype MPIREAL, const int timestamp)</div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:723</div></div>
<div class="ttc" id="class_dependency_cube_m_p_i_html_a65a7562678c7f9d7ab63780ffbdfac87"><div class="ttname"><a href="../../d3/d21/class_dependency_cube_m_p_i.html#a65a7562678c7f9d7ab63780ffbdfac87">DependencyCubeMPI::make_dependencies</a></div><div class="ttdeci">void make_dependencies(const bool isroot)</div><div class="ttdef"><b>Definition:</b> DependencyCubeMPI.h:213</div></div>
<div class="ttc" id="struct_stencil_info_html_ab3fce74853afec119eee90a6274d1559"><div class="ttname"><a href="../../da/d04/struct_stencil_info.html#ab3fce74853afec119eee90a6274d1559">StencilInfo::tensorial</a></div><div class="ttdeci">bool tensorial</div><div class="ttdef"><b>Definition:</b> StencilInfo.h:22</div></div>
<div class="ttc" id="class_dependency_cube_m_p_i_html_a057adc047896117c998e5709d8a83d43"><div class="ttname"><a href="../../d3/d21/class_dependency_cube_m_p_i.html#a057adc047896117c998e5709d8a83d43">DependencyCubeMPI::face</a></div><div class="ttdeci">void face(Request req, int d, int s)</div><div class="ttdef"><b>Definition:</b> DependencyCubeMPI.h:171</div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div></div>
<div class="ttc" id="struct_stencil_info_html_a6a07ebcb676dabaadf000e1348b8c016"><div class="ttname"><a href="../../da/d04/struct_stencil_info.html#a6a07ebcb676dabaadf000e1348b8c016">StencilInfo::selcomponents</a></div><div class="ttdeci">vector&lt; int &gt; selcomponents</div><div class="ttdef"><b>Definition:</b> StencilInfo.h:20</div></div>
<div class="ttc" id="class_dependency_cube_m_p_i_html_a9b187ce4ca44a150d71e55c35325afba"><div class="ttname"><a href="../../d3/d21/class_dependency_cube_m_p_i.html#a9b187ce4ca44a150d71e55c35325afba">DependencyCubeMPI::pendingcount</a></div><div class="ttdeci">int pendingcount() const </div><div class="ttdef"><b>Definition:</b> DependencyCubeMPI.h:330</div></div>
<div class="ttc" id="_h_d_f5_dumper_8h_html_a445a5f0e2a34c9d97d69a3c2d1957907"><div class="ttname"><a href="../../d2/d27/_h_d_f5_dumper_8h.html#a445a5f0e2a34c9d97d69a3c2d1957907">Real</a></div><div class="ttdeci">double Real</div><div class="ttdef"><b>Definition:</b> HDF5Dumper.h:19</div></div>
<div class="ttc" id="class_dependency_cube_m_p_i_html_a797a6e9d3cb5d7edf9439f4abbf27b05"><div class="ttname"><a href="../../d3/d21/class_dependency_cube_m_p_i.html#a797a6e9d3cb5d7edf9439f4abbf27b05">DependencyCubeMPI::corner</a></div><div class="ttdeci">void corner(Request req, int x, int y, int z)</div><div class="ttdef"><b>Definition:</b> DependencyCubeMPI.h:191</div></div>
<div class="ttc" id="_p_u_pkernels_m_p_i_8h_html"><div class="ttname"><a href="../../d7/dd2/_p_u_pkernels_m_p_i_8h.html">PUPkernelsMPI.h</a></div></div>
<div class="ttc" id="struct_stencil_info_html_a584955f3761b5854a9050c97cba3c3ca"><div class="ttname"><a href="../../da/d04/struct_stencil_info.html#a584955f3761b5854a9050c97cba3c3ca">StencilInfo::ey</a></div><div class="ttdeci">int ey</div><div class="ttdef"><b>Definition:</b> StencilInfo.h:19</div></div>
<div class="ttc" id="class_synchronizer_m_p_i_html"><div class="ttname"><a href="../../d0/ddf/class_synchronizer_m_p_i.html">SynchronizerMPI</a></div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:25</div></div>
<div class="ttc" id="struct_stencil_info_html_afbdda2df54c6af8e9e8b8536e6e31bdc"><div class="ttname"><a href="../../da/d04/struct_stencil_info.html#afbdda2df54c6af8e9e8b8536e6e31bdc">StencilInfo::ez</a></div><div class="ttdeci">int ez</div><div class="ttdef"><b>Definition:</b> StencilInfo.h:19</div></div>
<div class="ttc" id="_p_u_pkernels_m_p_i_8h_html_a8b5aa2551611fcb7d92dda8966cbbda3"><div class="ttname"><a href="../../d7/dd2/_p_u_pkernels_m_p_i_8h.html#a8b5aa2551611fcb7d92dda8966cbbda3">unpack</a></div><div class="ttdeci">void unpack(const Real *const pack, Real *const dstbase, const unsigned int gptfloats, const int *const selected_components, const int ncomponents, const int nsrc, const int dstxstart, const int dstystart, const int dstzstart, const int dstxend, const int dstyend, const int dstzend, const int xsize, const int ysize, const int zsize)</div><div class="ttdef"><b>Definition:</b> PUPkernelsMPI.h:47</div></div>
<div class="ttc" id="_p_u_pkernels_m_p_i_8h_html_a0d024fa525007ee6941795fb3f66f92d"><div class="ttname"><a href="../../d7/dd2/_p_u_pkernels_m_p_i_8h.html#a0d024fa525007ee6941795fb3f66f92d">unpack_subregion</a></div><div class="ttdeci">void unpack_subregion(const Real *const pack, Real *const dstbase, const unsigned int gptfloats, const int *const selected_components, const int ncomponents, const int srcxstart, const int srcystart, const int srczstart, const int LX, const int LY, const int dstxstart, const int dstystart, const int dstzstart, const int dstxend, const int dstyend, const int dstzend, const int xsize, const int ysize, const int zsize)</div><div class="ttdef"><b>Definition:</b> PUPkernelsMPI.h:65</div></div>
<div class="ttc" id="_grid_m_p_i_8h_html"><div class="ttname"><a href="../../dd/d1d/_grid_m_p_i_8h.html">GridMPI.h</a></div></div>
<div class="ttc" id="struct_stencil_info_html_a4f024cdf41fca32720321fa95bd2a8bd"><div class="ttname"><a href="../../da/d04/struct_stencil_info.html#a4f024cdf41fca32720321fa95bd2a8bd">StencilInfo::sy</a></div><div class="ttdeci">int sy</div><div class="ttdef"><b>Definition:</b> StencilInfo.h:19</div></div>
<div class="ttc" id="class_synchronizer_m_p_i_html_a783e782e542e65144eda9105ae986e3b"><div class="ttname"><a href="../../d0/ddf/class_synchronizer_m_p_i.html#a783e782e542e65144eda9105ae986e3b">SynchronizerMPI::~SynchronizerMPI</a></div><div class="ttdeci">~SynchronizerMPI()</div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:717</div></div>
<div class="ttc" id="class_dependency_cube_m_p_i_html_a95e03004604866099b5acf0af2cf3b1a"><div class="ttname"><a href="../../d3/d21/class_dependency_cube_m_p_i.html#a95e03004604866099b5acf0af2cf3b1a">DependencyCubeMPI::avail</a></div><div class="ttdeci">vector&lt; Region &gt; avail()</div><div class="ttdef"><b>Definition:</b> DependencyCubeMPI.h:314</div></div>
<div class="ttc" id="class_synchronizer_m_p_i_html_a361cd2e7121eec06007dedc5cae65278"><div class="ttname"><a href="../../d0/ddf/class_synchronizer_m_p_i.html#a361cd2e7121eec06007dedc5cae65278">SynchronizerMPI::SynchronizerMPI</a></div><div class="ttdeci">SynchronizerMPI(const int synchID, StencilInfo stencil, vector&lt; BlockInfo &gt; globalinfos, MPI::Cartcomm cartcomm, const int mybpd[3], const int blocksize[3])</div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:648</div></div>
<div class="ttc" id="class_synchronizer_m_p_i_html_aef137611a6b701c39db613c5e9c62812"><div class="ttname"><a href="../../d0/ddf/class_synchronizer_m_p_i.html#aef137611a6b701c39db613c5e9c62812">SynchronizerMPI::done</a></div><div class="ttdeci">bool done() const </div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:996</div></div>
<div class="ttc" id="class_synchronizer_m_p_i_html_a1fe2fa97907cbae0ddc874cee4462d83"><div class="ttname"><a href="../../d0/ddf/class_synchronizer_m_p_i.html#a1fe2fa97907cbae0ddc874cee4462d83">SynchronizerMPI::avail</a></div><div class="ttdeci">vector&lt; BlockInfo &gt; avail(const int smallest)</div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:982</div></div>
<div class="ttc" id="class_synchronizer_m_p_i_html_ad67473ef9e13988052feef92c4c3f086"><div class="ttname"><a href="../../d0/ddf/class_synchronizer_m_p_i.html#ad67473ef9e13988052feef92c4c3f086">SynchronizerMPI::getpedata</a></div><div class="ttdeci">void getpedata(int mypeindex[3], int pesize[3], int mybpd[3]) const </div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:1008</div></div>
<div class="ttc" id="class_dependency_cube_m_p_i_html_abd4e8187ccfe651ded18f8c5c10fa691"><div class="ttname"><a href="../../d3/d21/class_dependency_cube_m_p_i.html#abd4e8187ccfe651ded18f8c5c10fa691">DependencyCubeMPI::prepare</a></div><div class="ttdeci">void prepare()</div><div class="ttdef"><b>Definition:</b> DependencyCubeMPI.h:335</div></div>
<div class="ttc" id="_dependency_cube_m_p_i_8h_html"><div class="ttname"><a href="../../d9/d33/_dependency_cube_m_p_i_8h.html">DependencyCubeMPI.h</a></div></div>
<div class="ttc" id="struct_stencil_info_html_a00e8cbf611bbb74ad861a6d74b6d0d9f"><div class="ttname"><a href="../../da/d04/struct_stencil_info.html#a00e8cbf611bbb74ad861a6d74b6d0d9f">StencilInfo::sz</a></div><div class="ttdeci">int sz</div><div class="ttdef"><b>Definition:</b> StencilInfo.h:19</div></div>
<div class="ttc" id="class_synchronizer_m_p_i_html_abac3624b538d4968e1953a2aee32d449"><div class="ttname"><a href="../../d0/ddf/class_synchronizer_m_p_i.html#abac3624b538d4968e1953a2aee32d449">SynchronizerMPI::fetch</a></div><div class="ttdeci">void fetch(const Real *const ptrBlock, Real *const ptrLab, const int x0, const int y0, const int z0, const int xsize, const int ysize, const int zsize, const int gptfloats, const int rsx, const int rex, const int rsy, const int rey, const int rsz, const int rez) const </div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:1038</div></div>
<div class="ttc" id="struct_stencil_info_html_a5eddf6f1b64ce03fc84e6e447e4d500f"><div class="ttname"><a href="../../da/d04/struct_stencil_info.html#a5eddf6f1b64ce03fc84e6e447e4d500f">StencilInfo::ex</a></div><div class="ttdeci">int ex</div><div class="ttdef"><b>Definition:</b> StencilInfo.h:19</div></div>
<div class="ttc" id="_p_u_pkernels_m_p_i_8h_html_a7a485735d2946aa4b92203577ff84081"><div class="ttname"><a href="../../d7/dd2/_p_u_pkernels_m_p_i_8h.html#a7a485735d2946aa4b92203577ff84081">pack</a></div><div class="ttdeci">void pack(const Real *const srcbase, Real *const dst, const unsigned int gptfloats, int *selected_components, const int ncomponents, const int xstart, const int ystart, const int zstart, const int xend, const int yend, const int zend)</div><div class="ttdef"><b>Definition:</b> PUPkernelsMPI.h:13</div></div>
<div class="ttc" id="_stencil_info_8h_html"><div class="ttname"><a href="../../d4/d4e/_stencil_info_8h.html">StencilInfo.h</a></div></div>
<div class="ttc" id="class_dependency_cube_m_p_i_html_a3c346f1108cb4f571a250b5a6e3cd868"><div class="ttname"><a href="../../d3/d21/class_dependency_cube_m_p_i.html#a3c346f1108cb4f571a250b5a6e3cd868">DependencyCubeMPI::edge</a></div><div class="ttdeci">void edge(Request req, int d, int a, int b)</div><div class="ttdef"><b>Definition:</b> DependencyCubeMPI.h:181</div></div>
<div class="ttc" id="struct_stencil_info_html"><div class="ttname"><a href="../../da/d04/struct_stencil_info.html">StencilInfo</a></div><div class="ttdef"><b>Definition:</b> StencilInfo.h:17</div></div>
<div class="ttc" id="class_dependency_cube_m_p_i_html_a6b7972db814a3469a2774946ba3062a4"><div class="ttname"><a href="../../d3/d21/class_dependency_cube_m_p_i.html#a6b7972db814a3469a2774946ba3062a4">DependencyCubeMPI::received</a></div><div class="ttdeci">void received(Request req)</div><div class="ttdef"><b>Definition:</b> DependencyCubeMPI.h:303</div></div>
<div class="ttc" id="class_synchronizer_m_p_i_html_aaa3b9722374a17f0703f09b6ae8f7821"><div class="ttname"><a href="../../d0/ddf/class_synchronizer_m_p_i.html#aaa3b9722374a17f0703f09b6ae8f7821">SynchronizerMPI::avail</a></div><div class="ttdeci">vector&lt; BlockInfo &gt; avail()</div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:892</div></div>
<div class="ttc" id="class_synchronizer_m_p_i_1_1_my_range_html"><div class="ttname"><a href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html">SynchronizerMPI::MyRange</a></div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:1015</div></div>
<div class="ttc" id="_p_u_pkernels_m_p_i_8h_html_ae1600280d9525d09b4d580fbf4ed81db"><div class="ttname"><a href="../../d7/dd2/_p_u_pkernels_m_p_i_8h.html#ae1600280d9525d09b4d580fbf4ed81db">pack_stripes</a></div><div class="ttdeci">void pack_stripes(const Real *const srcbase, Real *const dst, const unsigned int gptfloats, const int selstart, const int selend, const int xstart, const int ystart, const int zstart, const int xend, const int yend, const int zend)</div><div class="ttdef"><b>Definition:</b> PUPkernelsMPI.h:30</div></div>
<div class="ttc" id="class_synchronizer_m_p_i_1_1_my_range_html_ad6983d8512541933b4d057bbb2e99700"><div class="ttname"><a href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html#ad6983d8512541933b4d057bbb2e99700">SynchronizerMPI::MyRange::outside</a></div><div class="ttdeci">bool outside(MyRange range) const </div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:1025</div></div>
<div class="ttc" id="class_synchronizer_m_p_i_html_a3ef18cbe8ce8ce18e7c96dbd09419e11"><div class="ttname"><a href="../../d0/ddf/class_synchronizer_m_p_i.html#a3ef18cbe8ce8ce18e7c96dbd09419e11">SynchronizerMPI::getstencil</a></div><div class="ttdeci">StencilInfo getstencil() const </div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:1003</div></div>
<div class="ttc" id="class_synchronizer_m_p_i_1_1_my_range_html_a7c67048b9d5e4b2da18c0cd4bbb26892"><div class="ttname"><a href="../../d6/d85/class_synchronizer_m_p_i_1_1_my_range.html#a7c67048b9d5e4b2da18c0cd4bbb26892">SynchronizerMPI::MyRange::MyRange</a></div><div class="ttdeci">MyRange(const int sx, const int ex, const int sy, const int ey, const int sz, const int ez)</div><div class="ttdef"><b>Definition:</b> SynchronizerMPI.h:1021</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_a96298b6e4e31b6d79cda3fbdda75cb7.html">Cubism</a></li><li class="navelem"><a class="el" href="../../de/d4f/_synchronizer_m_p_i_8h.html">SynchronizerMPI.h</a></li>
    <li class="footer">Generated on Mon Mar 23 2015 17:33:06 for CubismUP_2D by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
